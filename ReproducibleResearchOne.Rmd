---
title: "Reproducible Research One"
author: "Joe Larson"
date: "November 20, 2016"
output: html_document
---

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = TRUE, include = TRUE, message = TRUE, warning = FALSE, results="markup")
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r echo=FALSE, message = FALSE}

library(lubridate)
library(data.table)
library(dplyr)
library(ggplot2)
library(RColorBrewer)
library(grid)

##  set working directory
setwd("C:/Users/Joe/Documents/Coursera/Johns Hopkins University/Reproducible Research/data")
```
### If the data set has not been download, download now

```{r echo=TRUE, message = FALSE}

if(!file.exists("activity.csv"))  {           
        temp <- tempfile()
        download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip", temp)
        unzip(zipfile = temp, "activity.csv")
        datedownload <- Sys.time() ## record the download date of the zip file
}

datedownload <- file.mtime("activity.csv")
data <- read.csv(file="activity.csv",header=TRUE)

```{r echo=FALSE, message = FALSE}

### Make data a datatable
datatable <- data.table(data)

### Setting labels to caps
names(datatable) <- c("Steps", "Date", "Interval")
datatables2 <- datatable

### Need to aid in doing data table math
setkey(datatable, Date)

### counting NAs
nasteps <- sum(is.na(datatable$Steps))
nadate <- sum(is.na(datatable$Date))
nainterval <- sum(is.na(datatable$Interval))

### Ptint NA results
print(paste0("The count of NAs in steps is ", nasteps, ", the count of NAs in date is ",nadate, ", the count of NAs in interval is ",nainterval," for a total of ",sum(nasteps + nadate + nainterval),"." ))

datasum <- as.data.frame(datatable[, sum(Steps, na.rm = TRUE),by = Date])
names(datasum) <- c("Date", "Steps")

datamean <- mean(datasum$Steps)
datamedian <- median(datasum$Steps)

print(paste0("The mean step value with NAs is ", round(datamean, digits = 0), " and the meadian step value with NAs is ", datamedian))
```
### Histogram Plot
```{r echo=TRUE, message = FALSE}
histogramsteps <- ggplot(datasum, aes(x=substr(datasum$Date, 6, 12), y=Steps))+ geom_bar(stat = "identity")+theme(axis.text.x=element_text(angle=-90, vjust=0.4,hjust=1))+ labs(x="Date")+ ggtitle("        Total number of steps taken each day with NA's")  
```{r echo=FALSE, message = FALSE}

plot(histogramsteps)


datasumnoNA <- as.data.frame(datatable[, mean(Steps, na.rm = TRUE),by = Interval])
names(datasumnoNA) <- c("Interval", "Steps")

datamaxinterval <- datasumnoNA[which(datasumnoNA$Steps == max(datasumnoNA$Steps)),]

print(paste0("Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps? The answer is interval : ", datamaxinterval$Interval," which has an avgerage step value ", trunc(datamaxinterval$Steps,digits = 0),"." ))


```
### Time Series Plot   
```{r echo=TRUE, message = FALSE}

timeseriesinterval <- ggplot(datasumnoNA, aes(x=datasumnoNA$Interval, y=Steps))+                     geom_line()+ theme(axis.text.x=element_text(angle=-90))+                             labs(x="Interval")+                                                                  ggtitle("                  Time series plot of steps taken each day with NA's")
plot(timeseriesinterval)

### With NA replaced with avg step per interval
no_na_data <- data
na_index <- which(is.na(no_na_data$steps))
data_no_na <- melt(data = data,id.vars="interval", measure.vars="steps", na.rm= TRUE)
interval_data <- dcast(data_no_na, interval ~ variable, mean)

for (counter in na_index) {
        step_temp <- no_na_data$interval[counter]
        index <- which(interval_data$interval == step_temp)
        no_na_data$steps[counter] <- interval_data$steps[index]
}

cat("Test total number of missing values is equal to =",sum(is.na(no_na_data$steps)))

```
### Histogram Plot without NA
```{r echo=TRUE, message = FALSE}
histogramsteps <- ggplot(no_na_data, aes(x=substr(no_na_data$date, 6, 12), y=steps))+geom_bar(stat = "identity")+theme(axis.text.x=element_text(angle=-90,vjust=0.4, hjust=1))+labs(x="Date")+ggtitle("        Total number of steps taken each day without NA's")              
```{r echo=FALSE, message = FALSE}

plot(histogramsteps)


no_na_datatable <- data.table(no_na_data)

nonasteps <- sum(is.na(no_na_datatable$steps))
nonadate <- sum(is.na(no_na_datatable$date))
nonainterval <- sum(is.na(no_na_datatable$interval))

print(paste0("The count of NAs in steps is ", nonasteps, ", the count of NAs in date is ",nonadate, ", the count of NAs in interval is ",nonainterval," for a total of ",sum(nonasteps + nonadate + nonainterval),". Zeros are  the desired answer." ))

datasumnano <- as.data.frame(no_na_datatable[, sum(steps, na.rm = TRUE),by = date])
names(datasumnano) <- c("date", "steps")

datameannano <- mean(datasumnano$steps)
datamediannano <- median(datasumnano$steps)


print(paste0("The mean step value with NAs is ", round(datameannano, digits = 0), " and the meadian step value with NAs is ", round(datamediannano, digits = 0)))

```
### Interval comparsion Weekday vs Weekend

```{r echo=FALSE, message = FALSE}
par(mfrow=c(2,1))
par(mar=c(2.1,2.1,2.1,1.1))

daytype <- function(date) {
        if (weekdays(as.Date(date)) %in% c("Saturday", "Sunday")) {
                "weekend"
        } else {
                "weekday"
        }
}
data$daytype <- as.factor(sapply(data$date, daytype))

for (type in c("weekend", "weekday")) {
        steps.type <- aggregate(steps ~ interval, data = data, subset = data$daytype == 
                                        type, FUN = mean)
        plot(steps.type, type = "l", main = type)
}
```
